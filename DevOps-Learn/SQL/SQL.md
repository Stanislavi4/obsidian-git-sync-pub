Содержание

1. 1. [Для чего нужен SQL](https://blog.skillfactory.ru/glossary/sql/#для-чего-нужен-sql)
2. 2. [Как работают запросы](https://blog.skillfactory.ru/glossary/sql/#как-работают-запросы)
3. 3. [Что такое база данных в SQL](https://blog.skillfactory.ru/glossary/sql/#что-такое-база-данных-в-sql)
4. 4. [SQL-операторы](https://blog.skillfactory.ru/glossary/sql/#sqlоператоры)
5. 5. [Виды СУБД](https://blog.skillfactory.ru/glossary/sql/#виды-субд)
6. 6. [Как начать работу с SQL](https://blog.skillfactory.ru/glossary/sql/#как-начать-работу-с-sql)

SQL (от англ. Structured Query Language) — это структурированный язык запросов, созданный для того, чтобы получать из базы данных необходимую информацию. Если описать схему работы SQL простыми словами, то специалист формирует запрос и направляет его в базу. Та в свою очередь обрабатывает эту информацию, «понимает», что именно нужно специалисту, и отправляет ответ.

Данные хранятся в виде таблиц, они структурированы и разложены по строкам и столбцам, чтобы ими легче было оперировать. Такой способ хранения информации называют реляционными базами данных (от англ. _relation_ — «отношения»). Название указывает на то, что объекты в такой базе связаны определенными отношениями.

Например, у маркетолога есть база, в которой собрана информация обо всех пиццериях в городе: названия, ассортимент, цены, график работы и прочее. Во время анализа конкурентов он решил выяснить, сколько пиццерий готовят пиццу с ананасами и оформляют доставку после 23:00. Для того чтобы получить такой список из базы, достаточно написать грамотный SQL-запрос.

## Для чего нужен SQL

SQL — это не язык программирования, поэтому написать приложение или сайт с его помощью не получится, но при этом внутренняя работа сайта ([backend](https://blog.skillfactory.ru/kak-stat-behkend-razrabotchikom-s-nulya-poshagovoe-rukovodstvo-dlya-novichkov/)) невозможна без запросов. Поиск информации в Google — это тоже модель использования SQL. Пользователь задает параметры, которые его интересуют, и отправляет запрос на сервер; затем происходит магия и в поисковой выдаче появляются результаты, соответствующие именно этому запросу.

SQL используют разные виды специалистов:

- [**Аналитики**](https://blog.skillfactory.ru/kto-takoj-analitik-dannyh/) **и** [**продуктовые маркетологи**](https://blog.skillfactory.ru/ya-byla-marketologom-a-stala-prodakt-menedzherom-v-it/)**.** Знание SQL помогает этим специалистам не зависеть от программистов, а самостоятельно получать и обрабатывать данные.
- [**Разработчики**](https://blog.skillfactory.ru/kto-takoj-frontend/) **и** [**тестировщики**](https://blog.skillfactory.ru/kto-takoj-testirovshhik-po/)**.** С помощью SQL они могут самостоятельно проектировать базы для быстрой и надежной работы с данными, улучшать с их помощью сайты и приложения.
- **Руководители и менеджеры.** SQL позволит специалистам на руководящих постах самостоятельно обращаться к базам, контролировать работу компании и в реальном времени получать данные о положении дел.
## Как работают запросы

Чтобы разобраться, как именно работает магия запроса, давайте представим его путь от пользователя до нужных ему данных:

_Пользователь → Клиент → Запрос → Система управления → База данных → Таблица с базами данных_

Данные для работы с SQL хранятся в таблицах. Как именно они устроены — разберемся ниже; пока же просто представим их. На пути от пользователя к таблице находится несколько посредников:

- **Клиент —** способ введения запроса. В случае с Google, например, клиентом будет поисковая строка браузера, в которую пользователь вводит сформулированный запрос.
- **Система управления базами данных (СУБД) —** комплекс программ, которые позволяют управлять данными. Эта система помогает таблицам понять, чего хочет пользователь, а пользователю — что ему отвечают таблицы.
- **База данных —** система хранения таблиц, в которой они связаны между собой. База данных сама по себе не умеет манипулировать информацией — это просто хранилище, где у каждого объекта есть свое место.
## Что такое база данных в SQL

SQL-запросы обращаются к данным в виде таблиц, то есть к реляционным базам данных. Упрощенный вариант такой базы — это таблицы Excel, в которых информация также упорядочена в столбцы и строки.

Основные понятия реляционной модели:

1. **Отношение** **—** это сама таблица, она двумерная и состоит из столбцов и строк.

2. **Атрибут —** столбец в таблице, который содержит один конкретный параметр: название, тип, дату, стоимость или другую характеристику.

![[7e800b73a70959a00ecb3bf27558caf2_MD5.png]]

3. **Домен —** это допустимые значения для каждого атрибута. Например, в столбце «Имя» или «Название» значения должны представлять собой набор буквенных символов, но они не могут начинаться с «ь» или «ъ» и не могут быть записаны числами.

4. **Кортеж (строка или запись) —** это табличная строка с порядковым номером, в которой содержится информация об одном конкретном объекте.

![[b829127281eab522a78951c4724c1522_MD5.png]]

5. **Значение** **—** элемент таблицы, который находится на пересечении столбцов и строк.

![[0d9816d1d8c6bce0bea424962a72a32f_MD5.png]]

6. **Ключ** **—** это самый важный столбец в таблице, за счет этих значений и происходит взаимодействие в реляционной базе данных, он связывает таблицы между собой.

![[b13121450f19795f3ed3109f4f54bb92_MD5.png]]

Ключи бывают нескольких видов:

- Первичный ключ — идентификатор, такой как индекс или артикул.
- Потенциальный ключ — другое уникальное значение, которое может служить идентификатором.
- Внешний ключ — столбец-ссылка, используется для объединения двух таблиц, каждое значение внешнего ключа обязательно соответствует первичному ключу в другой таблице.

![[4d7cceb79529cb68e24ef8a669ff131f_MD5.png]]

Например, для решения задачи — выбрать все пиццерии, которые смогут доставить пиццу с ананасами после 23:00, — кроме основной таблицы с графиками работы понадобятся также таблицы с ассортиментом каждого заведения, а также таблицы с составом каждой пиццы (чтобы понять, есть ли в ней ананасы). Все эти таблицы будут связаны между собой с помощью ключей.

![[f102d17e510e4bfc0c9cf2edbbff1a2d_MD5.png]]

Список пиццерий в городе

![[d43e5174b86d25208a26e7a80a5d952d_MD5.png]]

Ассортимент одной из пиццерий с ключом id — 1

## SQL-операторы

Работать с данными помогают операторы — определенные слова или символы, которые используются для выполнения конкретной операции — например, для выбора из множества по конкретному параметру. Если нам нужно из всех видов пиццы отсортировать те, в которых есть пармезан, — нужно использовать оператор SELECT (выбор в соответствии с условием).

Операторы в SQL делятся на несколько групп в соответствии с задачами, которые они решают.

**DDL (Data Definition Language) —** операторы определения данных. Они работают с объектами, то есть с целыми таблицами. Если базу нужно дополнить таблицей с новыми данными или, наоборот, убрать одну из таблиц с ошибочными данными — используется этот набор операторов.

- CREATE — создание объекта в базе данных
- ALTER — изменение объекта
- DROP — удаление объекта

**DML (Data Manipulation Language) —** операторы манипуляции данными. Эти операторы уже работают с содержимым таблиц — строками, атрибутами и значениями. С их помощью можно вносить изменения в конкретное значение. Например, заменить поле в колонке «Фамилия» в строке с данными сотрудницы компании посте того, как она вышла замуж. Или удалить строку с данными уволенного сотрудника.

- SELECT — выбор данных в соответствии с условием
- INSERT — добавление новых данных
- UPDATE — изменение существующих данных
- DELETE — удаление данных

**DCL (Data Control Language) —** оператор определения доступа к данным. Он определяет, кто из пользователей может отправлять запросы к базе, менять объекты и значения. Например, можно отозвать доступ у сотрудника, перешедшего в другой отдел, а также открыть доступ к базе новому маркетологу или разработчику.

- GRANT — предоставление доступа к объекту
- REVOKE — отзыв ранее выданного разрешения
- DENY — запрет, который является приоритетным над разрешением

**TCL (Transaction Control Language) —** язык управления транзакциями. Транзакции — это набор команд, которые выполняются поочередно. Если все команды выполнены, транзакция считается успешной, а если где-то произошла ошибка — транзакция откатывается назад, отменяя все выполненные команды. Наглядный пример такой транзакции — оплата онлайн, когда банк просит сначала ввести сумму и получателя, затем проверить и подтвердить операцию, а после ввести одноразовый код. На каждом из этих этапов оплату можно отменить и транзакция откатится назад.

- BEGIN TRANSACTION — обозначение начала транзакции
- COMMIT TRANSACTION — изменение команд внутри транзакции
- ROLLBACK TRANSACTION — откат транзакции
- SAVE TRANSACTION — указание промежуточной точки сохранения внутри транзакции

## Виды СУБД

Сами по себе таблицы или база данных не способны выполнять операции, а в СУБД можно создавать новые таблицы, удалять ненужные данные, настраивать ключи и обрабатывать запросы. Основные задачи СУБД:

- поддержка языков баз данных;
- непосредственное управление данными;
- управление буферами оперативной памяти;
- управление транзакциями;
- резервное копирование и восстановление после сбоев.

Существуют разные виды таких систем, которые разрабатывает и техногиганты, вроде Google, Microsoft и Amazon, и более нишевые студии. Разработчики стремятся сделать свой продукт лучше, чтобы их система быстрее и качественнее других обрабатывала данные. ==Из-за этого появились разные виды языка SQL — так называемые SQL-диалекты. У каждой СУБД диалект имеет что-то общее со всеми, а также свои особенности, которые не будут работать в другой системе.==

СУБД могут быть коммерческими или иметь открытый код. Системы управления с открытым кодом можно бесплатно использовать в проектах, а также дополнять их документацию и совершенствовать процесс работы с системой. Коммерческие СУБД имеют платный доступ к полным версиям — как правило, такие используют крупные корпорации.

![[7fe79e8dfec822d27115ba167ec5e590_MD5.png]]

- **PostgreSQL —** это объектно-ориентированная система, то есть она обрабатывает данные как абстрактные объекты. Каждый объект, в отличие от простых табличных значений, может иметь собственные характеристики и уникальные методы взаимодействия с другими объектами. Это позволяет PostgreSQL обрабатывать более сложные структуры данных и выполнять более сложные процедуры. Например, Яндекс.Почта в свое время [перешла](https://habr.com/ru/post/321756/) на эту систему, чтобы поддерживать стабильное соединение десятков тысяч пользователей к одной базе.
- **MySQL —** простая в изучении и функциональная система, которая работает с сайтами и веб-приложениями. Чаще всего используется в системах управления контентом сайтов (CMS), на сайтах с возможностью регистрации пользователей, в корпоративных системах CRM, в планировщиках, чатах и форумах. MySQL считается одним из самых безопасных и высокоскоростных решений, которое существует на рынке.
- **SQLite —** это облегченная встраиваемая версия СУБД. В ней нет возможности поделиться правами доступа, как во многих других системах, но благодаря своему устройству эта система быстрая и мощная. SQLite подходит для обработки запросов на сайтах с низким и средним трафиком, а также в однопользовательских мобильных приложениях и играх. Преимущество такой системы — файловая структура, то есть база в SQLite состоит из одного файла, поэтому ее очень легко переносить.
- **Oracle —** одна из первых СУБД, которая появилась еще в 1977 году и развивается до сих пор. Это кроссплатформенная система, которая может работать на Windows, Linux, MacOS, мобильных и других ОС. Система используется в крупных коммерческих проектах. Например, в России с Oracle сотрудничают операторы МТС и Теле2, банк «Открытие» и ВТБ.
- **Google Cloud Spanner —** это облачная система управления данными, которую Google разработал для управления собственными сервисами, например AdWords и Google Play. В 2017 году систему сделали общедоступной. Cloud Spanner относят к категории NewSQL — это системы, которые совмещают в себе преимущества реляционных и нереляционных СУБД.

## Как начать работу с SQL

Для начала работы с SQL достаточно разбираться в основах Excel, чтобы понимать принцип работы запросов, а также иметь базовый уровень английского на уровне A1-A2. Эти навыки необходимы, чтобы понимать синтаксис SQL:

- SELECT — выбери данные
- FROM — вот отсюда
- JOIN — добавь еще эти таблицы
- WHERE — при таком условии
- GROUP BY — сгруппируй данные по этому признаку
- ORDER BY — отсортируй данные по этому признаку
- LIMIT — нужно такое количество результатов
- ; — конец предложения

Системы для работы с SQL имеют схожую структуру: есть редактор запросов, результат запросов и список таблиц, которые используются для обработки.

![[80b0f5e49f4ca587f3a979616f0db4cf_MD5.png]]

Самостоятельно начать изучение SQL можно с просмотра уроков на YouTube и чтения тематических статей в профильных медиа. Для более системного усвоения информации и экономии времени, потраченного на обучение, лучше записаться на курсы к опытным преподавателям, где вы сразу попадете в профессиональное сообщество и будете получать поддержку менторов.

## Порядок выполнения SQL запроса

Порядок выполнения SQL запроса — это фактическая последовательность, в которой механизм базы данных обрабатывает различные компоненты SQL запроса. Это не то же самое, что порядок, в котором мы пишем запрос. Следуя определённому порядку выполнения, ядро базы данных может свести к минимуму дисковый ввод/вывод, эффективно использовать индексы и избежать ненужных операций. Это приводит к более быстрому выполнению запросов и меньшему потреблению ресурсов.

Возьмём пример SQL запроса и посмотрим, как он выполняется:

```sql
SELECT customers.name,
COUNT(order_id) as Total_orders,
SUM(order_amount) as total_spent
FROM customers
	JOIN orders ON customers.id = orders.customer_id
WHERE order_date >= '2023-01-01'
GROUP BY customers.name
HAVING total_spent >= 1000
ORDER BY customers.nameLIMIT 100;
```

Порядок выполнения этого запроса следующий:

1. **Предложение FROM**: Первым шагом является определение таблиц, задействованных в запросе. В данном случае это `customers` и `orders`.
2. **Предложение JOIN**: Следующим шагом является выполнение операции объединения на основе условия объединения. В данном случае это `customers.id = orders.customer_id`, которое связывает две таблицы, сопоставляя `id` клиентов.
3. **Предложение WHERE**: Третий шаг — применить условие фильтрации к объединённой таблице. В данном случае это `order_date >= '2023-01-01'`, который выбирает только заказы, сделанные 1 января 2023 года и позже. 
4. **Предложение GROUP BY**: Четвёртый шаг — сгруппировать строки по указанным столбцам. В данном случае это `customers.name`, которое создаёт группы на основе имени клиента.
5. **Предложение HAVING**: Пятый шаг — фильтрация групп по условию. В данном случае это `total_spent >= 1000`, при котором выбираются группы с общей потраченной суммой 1000 и более.
6. **Предложение SELECT**: Шестой шаг — выбор столбцов и агрегатных функций из каждой группы. В данном случае это `customers.name`, `COUNT(order_id) as Total_orders` и `SUM(order_amount) as total_spent`.
7. **Предложение ORDER**: Седьмой шаг — сортировка строк по указанным столбцам. В данном случае это `customers.name`, которое сортирует строки в алфавитном порядке по именам клиентов.
8. **Предложение LIMIT**: Последний шаг — пропустить несколько строк из отсортированного набора результатов. В данном случае результат ограничивается максимум `100` строками.
    
    ![[sql-query-execution-order.avif]]

<<<<<<< HEAD
## Правила SARGABLE

SARGABLE переводится как "Искомый аргумент" и относится к запросам, которые могут использовать индексы для более быстрого выполнения. Индексы — это структуры данных, которые хранят подмножество столбцов из таблицы в отсортированном порядке, что позволяет выполнять быстрый поиск и сравнение.

Запрос SARGABLE, если он использует операторы и функции, которые могут использовать преимущества индексов. Например, использование операторов равенства (`=`), неравенства (`<>`, `!=`), диапазона (`BETWEEN`) или членства (`IN`) в индексированных столбцах может сделать запрос SARGABLE.

Запрос не SARGABLE, если он использует операторы или функции, которые препятствуют использованию индекса или требуют полного сканирования таблицы. Например, использование операторов отрицания (`NOT`), подстановочных знаков (`LIKE`) или арифметических операций (`+`, `-`, `*`, `/`) в индексированных столбцах может сделать запрос не SARGABLE.

Для написания SARGABLE запроса необходимо следовать некоторым общим рекомендациям:

- Избегайте использования функций для индексированных столбцов в предложении `WHERE`, таких, как `UPPER()`, `LOWER()`, `SUBSTRING()` и т.д.
- Избегайте использования арифметических операций над индексированными столбцами в предложении `WHERE`, например `столбец + 1 > 10`, `столбец * 2 < 20` и т.д.
- Избегайте использования операторов отрицания для индексированных столбцов в предложении `WHERE`, таких, как `NOT IN`, `NOT LIKE`, `NOT EXISTS` и т.д.
- Избегайте использования подстановочных знаков в индексированных столбцах в предложении `WHERE` с ведущими подстановочными знаками (`%`), такими как `LIKE '%abc'`, `LIKE -xyz%'` и т.д.
- Используйте соответствующие типы данных для столбцов и литералов, чтобы избежать неявных преобразований, которые могут повлиять на использование индекса.

Вот несколько примеров запросов SARGABLE и не SARGABLE:

```sql
Плохой: SELECT ... WHERE Year(myDate) = 2022
Исправленный: SELECT ... WHERE myDate >= '01-01-2022' AND myDate < '01-01-2023'

Плохой: Select ... WHERE SUBSTRING(DealerName,4) = 'Ford'
Исправленный: Select ... WHERE DealerName Like 'Ford%'

Плохой: Select ... WHERE DateDiff(mm, OrderDate, GetDate ()) >= 30
Исправленный: Select ... WHERE OrderDate < DateAdd(mm, -30, GetDate())
```
=======
## Правила SARGABLE
>>>>>>> origin/master
