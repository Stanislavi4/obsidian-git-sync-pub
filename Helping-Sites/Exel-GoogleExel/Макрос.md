Содержание

1. 1. [Кто пользуется макросами в работе](https://blog.skillfactory.ru/glossary/makros/#кто-пользуется-макросами-в-работе)
2. 2. [Для чего нужны макросы](https://blog.skillfactory.ru/glossary/makros/#для-чего-нужны-макросы)
3. 3. [Как это работает](https://blog.skillfactory.ru/glossary/makros/#как-это-работает)
4. 4. [VBA: язык для макросов](https://blog.skillfactory.ru/glossary/makros/#vba-язык-для-макросов)
5. 5. [Как создать макрос в Excel](https://blog.skillfactory.ru/glossary/makros/#как-создать-макрос-в-excel)
6. 6. [Ограничения в использовании макрорекордера](https://blog.skillfactory.ru/glossary/makros/#ограничения-в-использовании-макрорекордера)
7. 7. [Что лучше: писать код или записывать действия](https://blog.skillfactory.ru/glossary/makros/#что-лучше-писать-код-или-записывать-действия)
8. 8. [Расширение файлов с макросами](https://blog.skillfactory.ru/glossary/makros/#расширение-файлов-с-макросами)
9. 9. [Абсолютные и относительные значения](https://blog.skillfactory.ru/glossary/makros/#абсолютные-и-относительные-значения)
10. 10. [Создание макроса через запись: пошаговая инструкция](https://blog.skillfactory.ru/glossary/makros/#создание-макроса-через-запись-пошаговая-инструкция)
11. 11. [Как пользоваться созданным макросом](https://blog.skillfactory.ru/glossary/makros/#как-пользоваться-созданным-макросом)

Макрос, или макрокоманда — это небольшая программа, которая выполняет заданный набор действий в офисном документе. Чаще всего макросами пользуются в [Microsoft Office Excel](https://blog.skillfactory.ru/glossary/excel/) для работы с таблицами. Создать и запустить их можно внутри Excel.

Макрос — подобие скрипта: небольшой программы, четко заточенной под определенные действия, чаще всего не имеющей графического интерфейса. Программу можно представить как большую и обширную команду, заданную системе. Поэтому второе название макроса — макрокоманда.

## Кто пользуется макросами в работе

Макросами желательно уметь пользоваться всем, кто активно работает с Excel. Это экономисты, разные категории менеджеров, аналитики и специалисты по маркетингу или рекламе. Им приходится обрабатывать табличные данные, иногда в больших количествах.

Умение работать с макросами — не всегда обязательное условие для получения работы, но крайне желательно и может быть полезно в любом случае, если вы часто сталкиваетесь с Excel-таблицами.

## Для чего нужны макросы

Макросы помогают:

- упростить и ускорить работу с документами;
- автоматизировать рутину и сконцентрироваться на интеллектуальных задачах;
- избежать человеческих ошибок в ряде задач, таких как, например, форматирование данных в таблице;
- быстро находить нужную информацию среди большого объема данных;
- объединять работу в нескольких продуктах Microsoft Office, потому что один макрос может работать с разными программами офисного пакета;
- создавать дополнительные функции, которых нет в программе изначально, но которые могут понадобиться пользователю.

## Как это работает

Работа с макросами выглядит так: сначала пользователь создает набор команд с помощью инструментов внутри Excel, потом запускает выполнение одной кнопкой. В результате то, что вручную пришлось бы делать несколько минут, выполняется автоматически и не требует усилий со стороны человека. Так автоматизируют рутинные процессы.

Сохранить макрос можно локально — для конкретного документа, или глобально — для всех документов.

Когда макрос запускают, Excel выполняет его код — совершает действия, которые в нем описаны. Это похоже на написание и запуск программы при разработке скриптов, но для создания макросов не обязательно уметь программировать.

Запускать макрос можно сколько угодно раз, и он каждый раз будет выполнять заложенные в нем действия.

## VBA: язык для макросов

«Изнутри» макрос — код на [языке программирования](https://blog.skillfactory.ru/glossary/yazyk-programmirovaniya/) VBA, который принадлежит Microsoft. Аббревиатура расшифровывается как Visual Basic Application. Язык основан на [Visual Basic](https://blog.skillfactory.ru/glossary/visual-basic/), но адаптирован для использования внутри офисного пакета. Код описывает команды, которые нужно выполнить.

![[f6ceb1db12da81033deb040419ba3942_MD5.gif]]

Окно VBA в Excel

VBA встроен в Excel и другие программы Microsoft Office. Это значит, что они распознают язык и могут выполнять написанные на нем команды, если те поступят в программу. Писать на нем можно изнутри офисного пакета в окне Visual Basic — оно открывается через меню.

Пользователь, досконально знающий VBA, может создавать сложные макросы. Но разбираться в языке и уметь программировать для решения большинства задач не нужно. Создать макрос можно без написания кода вручную.

## Как создать макрос в Excel

Создать новую макрокоманду можно двумя способами: написать код на языке VBA или записать действия с помощью специального встроенного модуля — макрорекордера.

Для обоих способов нужно открыть панель макросов. Это можно сделать через меню: вкладка «Разработчик», кнопка «Макросы». Если у вас в интерфейсе нет вкладки разработчика, кнопку можно найти в разделе «Вид» справа. А можно настроить окно так, чтобы вкладка появилась:

1. перейти по пути «Файл — Параметры» или кликнуть правой кнопкой по меню;
2. выбрать «Параметры Excel» и «Настроить ленту»;
3. в списке «Основные вкладки» поставить галочку напротив пункта «Разработчик».

![[b9e0c2725bccd7440abad47e396e473a_MD5.jpg]]

Включение вкладки Разработчик в Excel

Теперь подробнее поговорим об обоих способах создания макроса.

**Написать код вручную.** Для этого понадобится открыть окно набора кода. Можно сделать это из вкладки «Разработчик»: там есть кнопка, которая называется Visual Basic. Если вы нажмете на нее, откроется окно. Оно будет пустым: редактор для написания кода надо открыть самостоятельно с помощью меню слева. Там есть кнопка View Code.

![[6c9be77c7baec5cf1f13c327f8d066ff_MD5.png]]

Пример простого макроса

Второй способ открыть интерфейс для написания кода — нажать на кнопку «Макросы», ввести название нового макроса в верхней строке и нажать «Создать». В этом случае окно VBA откроется уже с пустой «заготовкой» под макрос и открытым редактором, где прописаны начало и конец команды. Останется только написать код в этом редакторе и сохранить.

Мы не будем углубляться в синтаксис и правила написания кода на Visual Basic: если человек только начинает работать с макросами, поначалу он редко пользуется этой возможностью. Хотя в будущем она может серьезно ему помочь.

**Записать действия с таблицей.** Второй вариант, более простой и не требующий уметь программировать, — воспользоваться макрорекордером. Так называется встроенный инструмент Excel, который «записывает» действия пользователя и потом на их основе автоматически генерирует код. Это похоже на запись видео или звука, только «пишутся» не кадры, а действия.

![[d9bcba38ab80433b78f7886e9c867b1b_MD5.png]]

Кнопка записи макроса

Выглядит это так: человек нажимает во вкладке «Разработчик» на кнопку «Записать макрос», вводит для него название, а потом выполняет действия с таблицей. Макрорекордер записывает эти действия и переводит их в код на Visual Basic, который сохраняется в виде макроса. Потом пользователь нажимает кнопку «Остановить запись», и рекордер прекращает записывать. Макрос готов, и им можно пользоваться

Пользоваться макрорекордером удобнее и быстрее для большинства действий. Его иногда рекомендуют как инструмент «для чайников», но вообще-то им пользуются и профессионалы, когда хотят сэкономить время.

## Ограничения в использовании макрорекордера

Запись макроса – мощный, но не всемогущий инструмент. У нее есть ряд ограничений. С ее помощью нельзя:

- создавать сложные конструкции, например условные, когда какое-то действие выполняется, только если справедливо некоторое условие, или циклы;
- придумывать команды, которых нет в Excel изначально, и писать их с нуля;
- выполнять действия, при которых не нужно выбирать ячейку таблицы — макрорекордер работает только с ячейками, а например, открыть другой лист не сможет.

Но все перечисленное можно сделать вручную с помощью VBA. Более того: код пишется на Visual Basic, и «понимать» его может не только Excel — практически все программы офисного пакета. Поэтому макрос, написанный самостоятельно, может взаимодействовать поочередно с несколькими программами, например загружать в Excel данные из Access. Возможность работы «за пределами» Excel специфична для кода, написанного вручную.

![[dae7d9aa3253a85df58fa45abd0e5de0_MD5.png]]

Окно выбора объектов

## Что лучше: писать код или записывать действия

Мы уже сказали, что макрорекордер чуть менее функционален; но есть еще одна деталь. Макрорекордер избыточен. Это значит, что при автоматической записи в макрос добавляется много лишнего, «мусорного» кода, и программы не оптимизированы. Потому они могут выполняться чуть медленнее, чем написанные вручную, и их тяжелее читать другим пользователям.

Это не значит, что от записи действий нужно отказываться. Нет, запись макросов — хороший способ сэкономить время на их создании. Но если вы знаете, что с вашей макрокомандой потом будет работать другой человек, или хотите выполнить какое-то сложное ресурсоемкое действие, лучше воспользоваться ручной записью.

В начале работы с макросами пользователь обычно не знаком с VBA или знаком, но слабо. Поэтому использование макрорекордера на этом этапе вполне оправдано и закономерно, помогает разобраться с тем, как работают макросы. Умение писать код на VBA приходит со временем, если человек постепенно учится.
## Расширение файлов с макросами

Обычный файл Excel не может сохранить внутри себя макрос. Чтобы тот остался в документе и его можно было пересылать вместе с таблицей, понадобится сохранить файл с расширением .xslm — он поддерживает макросы. Файлы с расширением .xlsx их не поддерживают.

![[49a119197c07dc91411e334beac23314_MD5.png]]

Формат сохранения файлов с макросами

## Абсолютные и относительные значения

Как и при написании функций в Excel, в макросах можно задавать абсолютные и относительные значения ячеек. По умолчанию макрос работает с абсолютными значениями — то есть, если вы кликнете в макрорекордере на ячейку B5, он при выполнении всегда будет выбирать B5. Чтобы макрос пользовался относительными значениями, то есть мог работать с разными ячейками, понадобится включить режим «Относительные ссылки». Кнопка для его включения находится прямо под кнопкой записи макроса.

В режиме относительных ссылок макрос начинает работу не с жестко зафиксированной ячейки с конкретным значением, а с той, которую сейчас выделил пользователь.

## Создание макроса через запись: пошаговая инструкция

Разберем использование макрорекордера пошагово. Это довольно просто: можно с ходу создать несложный макрос и потом пользоваться им, даже если вы раньше не имели дел с макрокомандами.

1. **Подготовка**
    
    Понадобится перейти в панель «Разработчик». Если вы хотите, чтобы макрокоманда работала не с жестко зафиксированными ячейками, а с теми, которые вы выберете, нажмите на кнопку «Относительные ссылки». Кнопка включит относительный режим. Если вам нужна работа с абсолютными значениями, проигнорируйте этот шаг.  
      
    После этого нужно будет нажать на кнопку «Запись макроса». ![[74dd6db8a8d8090a4dbfb4049b07cdc4_MD5.png]]
    
2. ****Параметры макроса****
    
    Откроется окно, в котором надо будет придумать уникальное имя для макрокоманды, а по желанию — комбинацию клавиш, которая будет запускать макрос. Там же надо будет:  
      
    1. Выбрать, где сохранится макрос — внутри открытого документа, внутри новой таблицы или в «личной книге», то есть глобально для всего Excel;  
    2. Придумать короткое описание, которое объясняет, что делает команда.  
      
    Описание и горячие клавиши не обязательны. Вариант сохранения по умолчанию — текущий документ, и им пользуются чаще всего, чтобы передавать таблицу другим можно было вместе с макросами. Личную книгу применяют, если пишут макрокоманду, которой планируют пользоваться в разных таблицах.  
      
    ==Кстати, личную книгу тоже можно передавать другим: это специальный файл внутри Excel, где хранится написанный пользователем код. В офисном пакете есть инструменты, позволяющие делиться этим файлом.==![[063441baea834a1fa6c352cbe6fa54fd_MD5.png]]
    
3. ****Запись действий****
    
    После того как вы настроите будущий макрос, понадобится нажать «ОК». Запустится запись. Макрорекордер начнет фиксировать действия, которые вы выполняете.  
      
    Это могут быть любые действия с ячейками: выделение, переход на другую ячейку, редактирование ее значения, вставка или применение форматирования. Например, записанный макрос поможет привести несколько таблиц к единому виду внешне. Пользователь выделит цветом верхнюю строку, изменит ширину столбцов и исправит выравнивание для контента.  
      
    Проверить, что макрорекордер работает, можно в левом нижнем углу окна Excel. Когда он записывает действия, там отображается значок в виде квадратика.![[f7c63eda809a1075eedac2797e698104_MD5.png]]
    
4. ****Особенности выполнения действий****
    
    Помните, что рекордер записывает все выделения, клики или переходы по ячейкам, поэтому старайтесь не совершать лишних действий. Если вы сделали что-то лишнее, отменить это можно, только если отредактировать код в редакторе Visual Basic — или записать макрос с самого начала.  
      
    Если вы не включили режим относительных ссылок, записанный макрос будет работать только в том диапазоне ячеек, который вы выбирали. Поэтому, если вы выделили, скажем, столбец A, то макрос не получится запустить для столбца B. Иногда это удобно — если вы точно знаете фиксированное количество столбцов или строк.
    
5. ****Остановка записи****
    
    Когда вы сделаете все необходимое, запись можно останавливать. Для этого нажмите кнопку «Остановить запись» в том же меню «Разработчик». Макрос запишется и сохранится. С этого момента он будет доступен для выполнения:  
      
    — если вы создали его для конкретной книги — из этой книги;  
    — если вы сохранили его в личную книгу — из любого документа Excel.![[2b46a903048af70a444f9d887d01ab3d_MD5.png]]
    

## Как пользоваться созданным макросом

Если при создании макроса вы задали для него комбинацию горячих клавиш, то его можно в любой момент запустить с помощью этого сочетания. Но обращайте внимание на то, где вы сохранили макрос: если только в пределах конкретной таблицы — запустить его из другого документа не получится, тот просто не будет о нем знать.

![[2cddbcfaa0a59d20bf38a0e0633c7c26_MD5.gif]]

Окно запуска макросов

Если же комбинации нет, то для запуска макроса понадобится перейти в меню «Разработчик» и там нажать на кнопку «Макросы». Откроется список созданных вами и доступных для этого документа макрокоманд. Нужно будет выбрать нужную и нажать «Выполнить». После этого макрос исполнится.

Мы советуем назначать горячие клавиши для макросов, которые вы планируете запускать часто, а через меню открывать более редко используемые.

Узнайте больше о макросах и использовании Excel на наших курсах менеджмента: мы поможем научиться современным инструментам и освоить востребованную профессию.